<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Gaias Grounds — Of the Earth · For the World</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&family=Josefin+Sans:wght@100;200;300;400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <style>
    :root {
      --earth:     #1E1208;
      --bark:      #2E1A0A;
      --clay:      #7A4F2E;
      --gold:      #C4A25A;
      --cream:     #EDE0CC;
      --parchment: #F2EAD8;
      --mist:      #F8F3EB;
      --sage:      #6B7C5E;
      --panel-w:   340px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Cormorant Garamond',Georgia,serif; background:#e8e0d0; height:100vh; overflow:hidden; }

    /* ── MAP (full screen base) ── */
    #map { position:fixed; inset:0; z-index:0; }
    .leaflet-tile { filter:sepia(0.25) saturate(0.85) brightness(1.05); }

    /* ── HEADER BAR ── */
    .header {
      position:fixed; top:0; left:0; right:0; z-index:400;
      height:56px;
      background:rgba(242,234,216,0.96);
      backdrop-filter:blur(16px);
      border-bottom:1px solid rgba(122,79,46,0.12);
      display:flex; align-items:center; justify-content:space-between;
      padding:0 1.25rem;
    }
    .header-logo { display:flex; align-items:center; gap:0.75rem; text-decoration:none; }
    .header-logo-text { display:flex; flex-direction:column; gap:0.1rem; }
    .header-logo-name {
      font-family:'Cormorant Garamond',serif; font-weight:400;
      font-size:1.15rem; letter-spacing:0.28em; text-transform:uppercase;
      color:var(--earth); line-height:1;
    }
    .header-logo-name span {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.55rem; letter-spacing:0.5em; color:rgba(122,79,46,0.55);
      margin-right:0.4rem;
    }
    .header-logo-sub {
      font-family:'Cormorant Garamond',serif; font-style:italic;
      font-size:0.72rem; letter-spacing:0.15em; color:rgba(122,79,46,0.5);
      line-height:1;
    }
    .header-global {
      display:flex; align-items:center; gap:0.5rem;
      text-decoration:none; opacity:0.6; transition:opacity 0.2s;
      border-left:1px solid rgba(122,79,46,0.15); padding-left:1rem;
    }
    .header-global:hover { opacity:1; }
    .header-global-text { display:flex; flex-direction:column; line-height:1; }
    .header-global-text span:first-child {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.5rem; letter-spacing:0.4em; text-transform:uppercase;
      color:rgba(122,79,46,0.5);
    }
    .header-global-text span:last-child {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.6rem; letter-spacing:0.32em; text-transform:uppercase;
      color:rgba(122,79,46,0.7);
    }

    /* ── LEFT PANEL (floating over map) ── */
    .panel {
      position:fixed; top:56px; left:0; bottom:0;
      width:var(--panel-w);
      z-index:300;
      display:flex; flex-direction:column;
      pointer-events:none;
      transition:transform 0.3s cubic-bezier(0.4,0,0.2,1);
    }
    .panel.collapsed {
      transform:translateX(calc(-1 * var(--panel-w) + 36px));
    }
    .panel-toggle {
      position:absolute; top:0.85rem; right:-1px;
      width:28px; height:28px;
      background:rgba(242,234,216,0.97);
      border:1px solid rgba(122,79,46,0.18);
      border-left:none;
      border-radius:0 6px 6px 0;
      cursor:pointer; pointer-events:all;
      display:flex; align-items:center; justify-content:center;
      color:var(--clay); font-size:0.7rem;
      box-shadow:2px 0 8px rgba(30,18,8,0.08);
      transition:background 0.2s;
      z-index:10;
    }
    .panel-toggle:hover { background:rgba(237,224,204,1); }

    /* ── SEARCH + FILTER BAR ── */
    .search-bar {
      margin:0.85rem 0.85rem 0;
      background:rgba(242,234,216,0.97);
      backdrop-filter:blur(16px);
      border:1px solid rgba(122,79,46,0.18);
      border-radius:10px;
      box-shadow:0 4px 20px rgba(30,18,8,0.12);
      overflow:hidden;
      pointer-events:all;
      flex-shrink:0;
    }

    .search-row {
      display:flex; align-items:center; gap:0; padding:0;
    }

    .search-input {
      flex:1; border:none; background:transparent;
      font-family:'Cormorant Garamond',serif; font-size:1rem;
      color:var(--earth); padding:0.75rem 1rem;
      outline:none; min-width:0;
    }
    .search-input::placeholder { color:rgba(122,79,46,0.38); font-style:italic; }

    .search-divider { width:1px; height:24px; background:rgba(122,79,46,0.15); flex-shrink:0; }

    .filter-btn {
      display:flex; align-items:center; gap:0.45rem;
      background:none; border:none; cursor:pointer;
      padding:0.75rem 1rem;
      font-family:'Josefin Sans',sans-serif; font-weight:300;
      font-size:0.62rem; letter-spacing:0.28em; text-transform:uppercase;
      color:rgba(122,79,46,0.7);
      transition:color 0.2s; white-space:nowrap;
    }
    .filter-btn:hover { color:var(--clay); }
    .filter-btn.active { color:var(--clay); }

    .filter-btn-icon {
      width:14px; height:10px;
      display:flex; flex-direction:column; gap:3px; flex-shrink:0;
    }
    .filter-btn-icon span {
      display:block; height:1.5px; background:currentColor; border-radius:2px;
      transition:all 0.2s;
    }
    .filter-btn-icon span:nth-child(2) { width:70%; }
    .filter-btn-icon span:nth-child(3) { width:45%; }

    /* ── FILTER PANEL (collapsible) ── */
    /* ── DROPDOWN FILTERS (Airbnb/Zillow style) ── */
    .filter-bar {
      display:flex; align-items:center; gap:0.4rem;
      padding:0.55rem 0.75rem;
      border-top:1px solid rgba(122,79,46,0.08);
      flex-wrap:nowrap; overflow-x:auto;
    }
    .filter-bar::-webkit-scrollbar { display:none; }

    .filter-pill {
      position:relative; flex-shrink:0;
    }
    .filter-pill-btn {
      display:flex; align-items:center; gap:0.35rem;
      font-family:'Josefin Sans',sans-serif; font-weight:300;
      font-size:0.6rem; letter-spacing:0.16em; text-transform:uppercase;
      padding:0.32rem 0.7rem;
      border:1px solid rgba(122,79,46,0.22); border-radius:20px;
      background:transparent; color:rgba(122,79,46,0.65);
      cursor:pointer; white-space:nowrap;
      transition:all 0.18s;
    }
    .filter-pill-btn:hover { border-color:var(--clay); color:var(--clay); }
    .filter-pill-btn.has-selection {
      background:var(--clay); border-color:var(--clay);
      color:var(--parchment);
    }
    .filter-pill-btn svg { transition:transform 0.2s; }
    .filter-pill-btn.open svg { transform:rotate(180deg); }

    .filter-dropdown {
      position:absolute; top:calc(100% + 6px); left:0; z-index:500;
      background:rgba(248,243,235,0.99);
      border:1px solid rgba(122,79,46,0.15);
      border-radius:10px;
      box-shadow:0 8px 32px rgba(30,18,8,0.14);
      min-width:180px; padding:0.6rem;
      display:none;
    }
    .filter-dropdown.open { display:block; }
    .filter-dropdown-title {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.5rem; letter-spacing:0.4em; text-transform:uppercase;
      color:rgba(122,79,46,0.4); padding:0.2rem 0.4rem 0.5rem;
      display:block;
    }
    .filter-option {
      display:flex; align-items:center; gap:0.6rem;
      padding:0.45rem 0.5rem; border-radius:6px;
      cursor:pointer; transition:background 0.15s;
    }
    .filter-option:hover { background:rgba(122,79,46,0.05); }
    .filter-option input[type=checkbox] { display:none; }
    .filter-checkbox {
      width:16px; height:16px; flex-shrink:0;
      border:1.5px solid rgba(122,79,46,0.3); border-radius:4px;
      display:flex; align-items:center; justify-content:center;
      transition:all 0.15s; background:transparent;
    }
    .filter-option.checked .filter-checkbox {
      background:var(--clay); border-color:var(--clay);
    }
    .filter-option.checked .filter-checkbox::after {
      content:''; display:block;
      width:5px; height:8px;
      border:1.5px solid white; border-top:none; border-left:none;
      transform:rotate(45deg) translateY(-1px);
    }
    .filter-option-label {
      font-family:'Josefin Sans',sans-serif; font-weight:300;
      font-size:0.62rem; letter-spacing:0.12em; text-transform:uppercase;
      color:rgba(122,79,46,0.75); flex:1;
    }
    .filter-option.checked .filter-option-label { color:var(--clay); font-weight:400; }

    /* Score slider */
    .score-options { display:flex; gap:0.3rem; flex-wrap:wrap; padding:0.2rem 0.3rem; }
    .score-opt {
      font-family:'Josefin Sans',sans-serif; font-weight:300;
      font-size:0.58rem; letter-spacing:0.1em;
      padding:0.28rem 0.6rem; border-radius:20px;
      border:1px solid rgba(122,79,46,0.2);
      color:rgba(122,79,46,0.6); cursor:pointer; transition:all 0.15s;
      background:transparent;
    }
    .score-opt:hover { border-color:var(--clay); color:var(--clay); }
    .score-opt.active { background:var(--clay); border-color:var(--clay); color:var(--parchment); }

    .filter-dropdown-footer {
      border-top:1px solid rgba(122,79,46,0.08);
      padding:0.4rem 0.4rem 0.1rem;
      display:flex; justify-content:flex-end;
    }
    .filter-clear-small {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.52rem; letter-spacing:0.18em; text-transform:uppercase;
      color:rgba(122,79,46,0.45); background:none; border:none;
      cursor:pointer; text-decoration:underline; text-underline-offset:2px;
    }
    .filter-clear-small:hover { color:var(--clay); }

    /* Active filter count badge */
    .filter-badge {
      display:inline-flex; align-items:center; justify-content:center;
      width:14px; height:14px; border-radius:50%;
      background:rgba(255,255,255,0.3);
      font-size:0.5rem; font-family:'Josefin Sans',sans-serif;
      font-weight:400; line-height:1;
    }


    .filter-count {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.58rem; letter-spacing:0.15em;
      color:rgba(122,79,46,0.5);
    }

    /* ── LOCATION LIST ── */
    .location-list {
      flex:1; overflow-y:auto; overflow-x:hidden;
      padding:0.65rem 0.85rem 1.5rem;
      pointer-events:all;
    }
    .location-list::-webkit-scrollbar { width:0; }

    .location-card {
      background:rgba(242,234,216,0.95);
      backdrop-filter:blur(8px);
      border:1px solid rgba(122,79,46,0.1);
      border-radius:8px;
      margin-bottom:0.5rem;
      padding:0.9rem 1rem;
      cursor:pointer;
      transition:all 0.2s ease;
      box-shadow:0 2px 8px rgba(30,18,8,0.06);
      position:relative; overflow:hidden;
    }
    .location-card::before {
      content:''; position:absolute;
      left:0; top:0; bottom:0; width:3px;
      background:var(--clay);
      transform:scaleY(0); transform-origin:bottom;
      transition:transform 0.2s;
    }
    .location-card:hover { border-color:rgba(122,79,46,0.25); box-shadow:0 4px 16px rgba(30,18,8,0.1); transform:translateY(-1px); }
    .location-card:hover::before, .location-card.active::before { transform:scaleY(1); }
    .location-card.active { border-color:rgba(122,79,46,0.3); background:rgba(237,224,204,0.98); }

    .card-header { display:flex; justify-content:space-between; align-items:flex-start; gap:0.5rem; margin-bottom:0.3rem; }
    .card-name { font-size:1.05rem; font-weight:500; color:var(--earth); line-height:1.2; flex:1; }
    .card-place { font-size:0.88rem; color:rgba(122,79,46,0.68); font-style:italic; margin-bottom:0.45rem; }
    .card-footer { display:flex; align-items:center; gap:0.4rem; flex-wrap:wrap; }

    .pill {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.5rem; letter-spacing:0.14em; text-transform:uppercase;
      padding:0.12rem 0.5rem; border-radius:2px; border:1px solid;
    }
    .pill-type  { border-color:rgba(107,124,94,0.3); color:var(--sage); }
    .pill-roast { border-color:rgba(122,79,46,0.2); color:var(--clay); }

    /* ── ROSETTE SCORE (correct SVG approach) ── */
    .rosette-mini { flex-shrink:0; }

    /* ── DETAIL PANEL ── */
    .detail {
      position:fixed; top:56px; right:0; bottom:0;
      width:400px;
      background:var(--mist);
      border-left:1px solid rgba(122,79,46,0.12);
      transform:translateX(100%);
      transition:transform 0.32s cubic-bezier(0.4,0,0.2,1);
      z-index:350; overflow-y:auto;
    }
    .detail.open { transform:translateX(0); }
    .detail::-webkit-scrollbar { width:3px; }
    .detail::-webkit-scrollbar-thumb { background:rgba(122,79,46,0.1); }

    @media(max-width:600px) { .detail { width:100%; } .panel { width:100%; } }

    .detail-close {
      position:sticky; top:0; z-index:10;
      display:flex; align-items:center; justify-content:space-between;
      padding:0.85rem 1.25rem;
      background:rgba(248,243,235,0.96); backdrop-filter:blur(8px);
      border-bottom:1px solid rgba(122,79,46,0.08);
    }
    .detail-close-label {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.58rem; letter-spacing:0.38em; text-transform:uppercase;
      color:rgba(122,79,46,0.5);
    }
    .detail-close-btn {
      background:none; border:1px solid rgba(122,79,46,0.2);
      color:var(--clay); width:26px; height:26px; border-radius:50%;
      cursor:pointer; font-size:0.8rem;
      display:flex; align-items:center; justify-content:center;
      transition:all 0.2s;
    }
    .detail-close-btn:hover { background:rgba(122,79,46,0.07); }

    .detail-hero {
      padding:1.5rem 1.5rem 1.25rem;
      background:linear-gradient(135deg, rgba(237,224,204,0.6) 0%, rgba(248,243,235,0.2) 100%);
      border-bottom:1px solid rgba(122,79,46,0.08);
    }

    /* Rosette score display in detail */
    .detail-score-row {
      display:flex; align-items:center; gap:1rem;
      margin-bottom:1.1rem;
    }
    .detail-score-info { display:flex; flex-direction:column; gap:0.2rem; }
    .detail-score-label {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.55rem; letter-spacing:0.38em; text-transform:uppercase;
      color:rgba(122,79,46,0.5);
    }
    .detail-score-value { font-size:1.15rem; font-weight:400; color:var(--clay); }
    .detail-score-sub {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.5rem; letter-spacing:0.2em; text-transform:uppercase;
      color:rgba(122,79,46,0.42);
    }

    .detail-name { font-size:1.5rem; font-weight:400; color:var(--earth); line-height:1.2; margin-bottom:0.28rem; }
    .detail-place { font-size:0.92rem; color:var(--clay); font-style:italic; margin-bottom:0.75rem; }
    .detail-tags { display:flex; gap:0.5rem; flex-wrap:wrap; margin-bottom:0.9rem; }
    .detail-desc { font-size:0.98rem; line-height:1.65; color:rgba(46,26,10,0.7); font-style:italic; }

    .detail-section { padding:1.15rem 1.5rem; border-bottom:1px solid rgba(122,79,46,0.07); }
    .detail-section-label {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.55rem; letter-spacing:0.42em; text-transform:uppercase;
      color:rgba(122,79,46,0.5); margin-bottom:0.85rem; display:block;
    }

    /* Principle bars */
    .principle-row { display:flex; align-items:center; gap:0.75rem; margin-bottom:0.5rem; }
    .principle-row:last-child { margin-bottom:0; }
    .principle-label {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.58rem; letter-spacing:0.16em; text-transform:uppercase;
      color:rgba(122,79,46,0.62); flex:1;
    }
    .principle-bar { width:80px; height:3px; background:rgba(122,79,46,0.1); border-radius:2px; overflow:hidden; flex-shrink:0; }
    .principle-fill { height:100%; background:var(--gold); border-radius:2px; }

    .product { padding:0.75rem 0.9rem; background:rgba(242,234,216,0.5); border:1px solid rgba(122,79,46,0.08); border-radius:4px; margin-bottom:0.4rem; }
    .product-top { display:flex; justify-content:space-between; align-items:baseline; margin-bottom:0.2rem; }
    .product-name { font-weight:500; font-size:0.98rem; color:var(--earth); }
    .product-price { font-family:'Josefin Sans',sans-serif; font-weight:300; font-size:0.62rem; color:var(--clay); }
    .product-notes { font-size:0.82rem; color:rgba(122,79,46,0.62); font-style:italic; }

    .contact-row { display:flex; align-items:center; gap:0.75rem; margin-bottom:0.45rem; font-size:0.9rem; }
    .contact-row:last-child { margin-bottom:0; }
    .contact-key {
      font-family:'Josefin Sans',sans-serif; font-weight:200;
      font-size:0.52rem; letter-spacing:0.12em; text-transform:uppercase;
      color:rgba(122,79,46,0.5); width:38px; flex-shrink:0;
    }
    .contact-val { color:rgba(30,18,8,0.75); }
    .contact-val a { color:var(--clay); text-decoration:none; }
    .contact-val a:hover { text-decoration:underline; }

    /* Leaflet */
    .leaflet-popup-content-wrapper { background:var(--mist)!important; border:1px solid rgba(122,79,46,0.2)!important; border-radius:6px!important; box-shadow:0 8px 32px rgba(30,18,8,0.15)!important; }
    .leaflet-popup-tip { background:var(--mist)!important; }
    .leaflet-popup-content { margin:12px 16px!important; font-family:'Cormorant Garamond',serif!important; }
    .popup-name { font-weight:500; font-size:1rem; color:var(--earth); margin-bottom:0.2rem; }
    .popup-sub { font-size:0.82rem; color:rgba(122,79,46,0.65); font-style:italic; }
    .popup-btn { display:inline-block; margin-top:0.5rem; font-family:'Josefin Sans',sans-serif; font-weight:200; font-size:0.52rem; letter-spacing:0.22em; text-transform:uppercase; color:var(--clay); border:1px solid rgba(122,79,46,0.28); padding:0.25rem 0.6rem; border-radius:2px; cursor:pointer; background:none; transition:all 0.2s; }
    .popup-btn:hover { background:rgba(122,79,46,0.06); }

    /* Loading */
    .loading { position:fixed; inset:0; background:var(--parchment); z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:2rem; transition:opacity 0.7s ease; }
    .loading.hidden { opacity:0; pointer-events:none; }
    @keyframes dotbounce { 0%,100%{transform:scale(1);opacity:.25}50%{transform:scale(1.6);opacity:.75} }
    @keyframes fadeUp { from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)} }
  </style>
</head>
<body>

<!-- Loading -->
<div class="loading" id="loading">
  <div style="display:flex;flex-direction:column;align-items:center;gap:2rem;animation:fadeUp 0.8s ease forwards;">
    <svg width="80" height="80" viewBox="60 60 80 80" fill="none">
      <path d="M67.1 119L68.4 121.2L70 123.3L71.6 125.2L73.4 127.1L75.2 128.8L77.3 130.4L79.4 131.9L81.6 133.2L83.8 134.4L86.2 135.4L88.6 136.3L91.1 136.9L93.6 137.5L96.2 137.8L98.7 138L101.3 138L103.8 137.8L106.4 137.5L108.9 136.9L111.4 136.3L113.8 135.4L116.2 134.4L118.4 133.2L120.6 131.9L122.7 130.4L124.8 128.8L126.6 127.1L128.4 125.2L130 123.3L131.6 121.2L132.9 119L131.6 116.8L130 114.7L128.4 112.8L126.6 110.9L124.8 109.2L122.7 107.6L120.6 106.1L118.4 104.8L116.2 103.6L113.8 102.6L111.4 101.7L108.9 101.1L106.4 100.5L103.8 100.2L101.3 100L98.7 100L96.2 100.2L93.6 100.5L91.1 101.1L88.6 101.7L86.2 102.6L83.8 103.6L81.6 104.8L79.4 106.1L77.3 107.6L75.2 109.2L73.4 110.9L71.6 112.8L70 114.7L68.4 116.8Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
      <path d="M100 138L102.6 137.9L105.1 137.7L107.6 137.2L110.1 136.6L112.6 135.9L115 134.9L117.3 133.8L119.6 132.6L121.7 131.2L123.8 129.7L125.7 128L127.5 126.2L129.2 124.3L130.8 122.2L132.2 120.1L133.5 117.9L134.7 115.6L135.6 113.2L136.4 110.8L137.1 108.3L137.6 105.8L137.9 103.2L138 100.6L138 98.1L137.7 95.5L137.3 93L136.8 90.5L136.1 88L135.2 85.6L134.1 83.3L132.9 81L130.3 81.1L127.8 81.3L125.3 81.8L122.8 82.4L120.3 83.1L117.9 84.1L115.6 85.2L113.4 86.4L111.2 87.8L109.1 89.3L107.2 91L105.4 92.8L103.7 94.7L102.1 96.8L100.7 98.9L99.4 101.1L98.2 103.4L97.3 105.8L96.5 108.2L95.8 110.7L95.3 113.2L95 115.8L94.9 118.4L95 120.9L95.2 123.5L95.6 126L96.1 128.5L96.8 131L97.7 133.4L98.8 135.7Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
      <path d="M132.9 119L134.1 116.7L135.2 114.4L136.1 112L136.8 109.5L137.3 107L137.7 104.5L138 101.9L138 99.4L137.9 96.8L137.6 94.2L137.1 91.7L136.4 89.2L135.6 86.8L134.7 84.4L133.5 82.1L132.2 79.9L130.8 77.8L129.2 75.7L127.5 73.8L125.7 72L123.8 70.3L121.7 68.8L119.6 67.4L117.3 66.2L115 65.1L112.6 64.1L110.1 63.4L107.6 62.8L105.1 62.3L102.6 62.1L100 62L98.8 64.3L97.7 66.6L96.8 69L96.1 71.5L95.6 74L95.2 76.5L95 79.1L94.9 81.6L95 84.2L95.3 86.8L95.8 89.3L96.5 91.8L97.3 94.2L98.2 96.6L99.4 98.9L100.7 101.1L102.1 103.2L103.7 105.3L105.4 107.2L107.2 109L109.1 110.7L111.2 112.2L113.4 113.6L115.6 114.8L117.9 115.9L120.3 116.9L122.8 117.6L125.3 118.2L127.8 118.7L130.3 118.9Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
      <path d="M100 62L97.4 62.1L94.9 62.3L92.4 62.8L89.9 63.4L87.4 64.1L85 65.1L82.7 66.2L80.4 67.4L78.3 68.8L76.2 70.3L74.3 72L72.5 73.8L70.8 75.7L69.2 77.8L67.8 79.9L66.5 82.1L65.3 84.4L64.4 86.8L63.6 89.2L62.9 91.7L62.4 94.2L62.1 96.8L62 99.4L62 101.9L62.3 104.5L62.7 107L63.2 109.5L63.9 112L64.8 114.4L65.9 116.7L67.1 119L69.7 118.9L72.2 118.7L74.7 118.2L77.2 117.6L79.7 116.9L82.1 115.9L84.4 114.8L86.6 113.6L88.8 112.2L90.9 110.7L92.8 109L94.6 107.2L96.3 105.3L97.9 103.2L99.3 101.1L100.6 98.9L101.8 96.6L102.7 94.2L103.5 91.8L104.2 89.3L104.7 86.8L105 84.2L105.1 81.6L105 79.1L104.8 76.5L104.4 74L103.9 71.5L103.2 69L102.3 66.6L101.2 64.3Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
      <path d="M67.1 81L65.9 83.3L64.8 85.6L63.9 88L63.2 90.5L62.7 93L62.3 95.5L62 98.1L62 100.6L62.1 103.2L62.4 105.8L62.9 108.3L63.6 110.8L64.4 113.2L65.3 115.6L66.5 117.9L67.8 120.1L69.2 122.2L70.8 124.3L72.5 126.2L74.3 128L76.2 129.7L78.3 131.2L80.4 132.6L82.7 133.8L85 134.9L87.4 135.9L89.9 136.6L92.4 137.2L94.9 137.7L97.4 137.9L100 138L101.2 135.7L102.3 133.4L103.2 131L103.9 128.5L104.4 126L104.8 123.5L105 120.9L105.1 118.4L105 115.8L104.7 113.2L104.2 110.7L103.5 108.2L102.7 105.8L101.8 103.4L100.6 101.1L99.3 98.9L97.9 96.8L96.3 94.7L94.6 92.8L92.8 91L90.9 89.3L88.8 87.8L86.6 86.4L84.4 85.2L82.1 84.1L79.7 83.1L77.2 82.4L74.7 81.8L72.2 81.3L69.7 81.1Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
      <path d="M132.9 81L131.6 78.8L130 76.7L128.4 74.8L126.6 72.9L124.8 71.2L122.7 69.6L120.6 68.1L118.4 66.8L116.2 65.6L113.8 64.6L111.4 63.7L108.9 63.1L106.4 62.5L103.8 62.2L101.3 62L98.7 62L96.2 62.2L93.6 62.5L91.1 63.1L88.6 63.7L86.2 64.6L83.8 65.6L81.6 66.8L79.4 68.1L77.3 69.6L75.2 71.2L73.4 72.9L71.6 74.8L70 76.7L68.4 78.8L67.1 81L68.4 83.2L70 85.3L71.6 87.2L73.4 89.1L75.2 90.8L77.3 92.4L79.4 93.9L81.6 95.2L83.8 96.4L86.2 97.4L88.6 98.3L91.1 98.9L93.6 99.5L96.2 99.8L98.7 100L101.3 100L103.8 99.8L106.4 99.5L108.9 98.9L111.4 98.3L113.8 97.4L116.2 96.4L118.4 95.2L120.6 93.9L122.7 92.4L124.8 90.8L126.6 89.1L128.4 87.2L130 85.3L131.6 83.2Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
    </svg>
    <div style="display:flex;flex-direction:column;align-items:center;gap:1rem;">
      <span style="font-family:'Josefin Sans',sans-serif;font-weight:200;font-size:0.55rem;letter-spacing:0.7em;text-transform:uppercase;color:rgba(122,79,46,0.35);">Gaias</span>
      <div style="font-family:'Cormorant Garamond',serif;font-weight:300;font-size:2.8rem;letter-spacing:0.6em;padding-left:0.6em;text-transform:uppercase;color:#1E1208;line-height:1;">Grounds</div>
      <div style="font-family:'Cormorant Garamond',serif;font-style:italic;font-size:0.9rem;letter-spacing:0.22em;color:rgba(122,79,46,0.5);">Of the Earth · For the World</div>
    </div>
    <div style="display:flex;gap:0.5rem;">
      <div style="width:5px;height:5px;background:#7A4F2E;border-radius:50%;opacity:0.25;animation:dotbounce 1.1s 0s infinite ease-in-out;"></div>
      <div style="width:5px;height:5px;background:#7A4F2E;border-radius:50%;opacity:0.25;animation:dotbounce 1.1s 0.18s infinite ease-in-out;"></div>
      <div style="width:5px;height:5px;background:#7A4F2E;border-radius:50%;opacity:0.25;animation:dotbounce 1.1s 0.36s infinite ease-in-out;"></div>
    </div>
  </div>
</div>

<!-- Map -->
<div id="map"></div>

<!-- Header -->
<header class="header">
  <a class="header-logo" href="#">
    <svg width="28" height="28" viewBox="60 60 80 80" fill="none">
      <path d="M67.1 119L68.4 121.2L70 123.3L71.6 125.2L73.4 127.1L75.2 128.8L77.3 130.4L79.4 131.9L81.6 133.2L83.8 134.4L86.2 135.4L88.6 136.3L91.1 136.9L93.6 137.5L96.2 137.8L98.7 138L101.3 138L103.8 137.8L106.4 137.5L108.9 136.9L111.4 136.3L113.8 135.4L116.2 134.4L118.4 133.2L120.6 131.9L122.7 130.4L124.8 128.8L126.6 127.1L128.4 125.2L130 123.3L131.6 121.2L132.9 119L131.6 116.8L130 114.7L128.4 112.8L126.6 110.9L124.8 109.2L122.7 107.6L120.6 106.1L118.4 104.8L116.2 103.6L113.8 102.6L111.4 101.7L108.9 101.1L106.4 100.5L103.8 100.2L101.3 100L98.7 100L96.2 100.2L93.6 100.5L91.1 101.1L88.6 101.7L86.2 102.6L83.8 103.6L81.6 104.8L79.4 106.1L77.3 107.6L75.2 109.2L73.4 110.9L71.6 112.8L70 114.7L68.4 116.8Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
      <path d="M100 138L102.6 137.9L105.1 137.7L107.6 137.2L110.1 136.6L112.6 135.9L115 134.9L117.3 133.8L119.6 132.6L121.7 131.2L123.8 129.7L125.7 128L127.5 126.2L129.2 124.3L130.8 122.2L132.2 120.1L133.5 117.9L134.7 115.6L135.6 113.2L136.4 110.8L137.1 108.3L137.6 105.8L137.9 103.2L138 100.6L138 98.1L137.7 95.5L137.3 93L136.8 90.5L136.1 88L135.2 85.6L134.1 83.3L132.9 81L130.3 81.1L127.8 81.3L125.3 81.8L122.8 82.4L120.3 83.1L117.9 84.1L115.6 85.2L113.4 86.4L111.2 87.8L109.1 89.3L107.2 91L105.4 92.8L103.7 94.7L102.1 96.8L100.7 98.9L99.4 101.1L98.2 103.4L97.3 105.8L96.5 108.2L95.8 110.7L95.3 113.2L95 115.8L94.9 118.4L95 120.9L95.2 123.5L95.6 126L96.1 128.5L96.8 131L97.7 133.4L98.8 135.7Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
      <path d="M132.9 119L134.1 116.7L135.2 114.4L136.1 112L136.8 109.5L137.3 107L137.7 104.5L138 101.9L138 99.4L137.9 96.8L137.6 94.2L137.1 91.7L136.4 89.2L135.6 86.8L134.7 84.4L133.5 82.1L132.2 79.9L130.8 77.8L129.2 75.7L127.5 73.8L125.7 72L123.8 70.3L121.7 68.8L119.6 67.4L117.3 66.2L115 65.1L112.6 64.1L110.1 63.4L107.6 62.8L105.1 62.3L102.6 62.1L100 62L98.8 64.3L97.7 66.6L96.8 69L96.1 71.5L95.6 74L95.2 76.5L95 79.1L94.9 81.6L95 84.2L95.3 86.8L95.8 89.3L96.5 91.8L97.3 94.2L98.2 96.6L99.4 98.9L100.7 101.1L102.1 103.2L103.7 105.3L105.4 107.2L107.2 109L109.1 110.7L111.2 112.2L113.4 113.6L115.6 114.8L117.9 115.9L120.3 116.9L122.8 117.6L125.3 118.2L127.8 118.7L130.3 118.9Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
      <path d="M100 62L97.4 62.1L94.9 62.3L92.4 62.8L89.9 63.4L87.4 64.1L85 65.1L82.7 66.2L80.4 67.4L78.3 68.8L76.2 70.3L74.3 72L72.5 73.8L70.8 75.7L69.2 77.8L67.8 79.9L66.5 82.1L65.3 84.4L64.4 86.8L63.6 89.2L62.9 91.7L62.4 94.2L62.1 96.8L62 99.4L62 101.9L62.3 104.5L62.7 107L63.2 109.5L63.9 112L64.8 114.4L65.9 116.7L67.1 119L69.7 118.9L72.2 118.7L74.7 118.2L77.2 117.6L79.7 116.9L82.1 115.9L84.4 114.8L86.6 113.6L88.8 112.2L90.9 110.7L92.8 109L94.6 107.2L96.3 105.3L97.9 103.2L99.3 101.1L100.6 98.9L101.8 96.6L102.7 94.2L103.5 91.8L104.2 89.3L104.7 86.8L105 84.2L105.1 81.6L105 79.1L104.8 76.5L104.4 74L103.9 71.5L103.2 69L102.3 66.6L101.2 64.3Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
      <path d="M67.1 81L65.9 83.3L64.8 85.6L63.9 88L63.2 90.5L62.7 93L62.3 95.5L62 98.1L62 100.6L62.1 103.2L62.4 105.8L62.9 108.3L63.6 110.8L64.4 113.2L65.3 115.6L66.5 117.9L67.8 120.1L69.2 122.2L70.8 124.3L72.5 126.2L74.3 128L76.2 129.7L78.3 131.2L80.4 132.6L82.7 133.8L85 134.9L87.4 135.9L89.9 136.6L92.4 137.2L94.9 137.7L97.4 137.9L100 138L101.2 135.7L102.3 133.4L103.2 131L103.9 128.5L104.4 126L104.8 123.5L105 120.9L105.1 118.4L105 115.8L104.7 113.2L104.2 110.7L103.5 108.2L102.7 105.8L101.8 103.4L100.6 101.1L99.3 98.9L97.9 96.8L96.3 94.7L94.6 92.8L92.8 91L90.9 89.3L88.8 87.8L86.6 86.4L84.4 85.2L82.1 84.1L79.7 83.1L77.2 82.4L74.7 81.8L72.2 81.3L69.7 81.1Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
      <path d="M132.9 81L131.6 78.8L130 76.7L128.4 74.8L126.6 72.9L124.8 71.2L122.7 69.6L120.6 68.1L118.4 66.8L116.2 65.6L113.8 64.6L111.4 63.7L108.9 63.1L106.4 62.5L103.8 62.2L101.3 62L98.7 62L96.2 62.2L93.6 62.5L91.1 63.1L88.6 63.7L86.2 64.6L83.8 65.6L81.6 66.8L79.4 68.1L77.3 69.6L75.2 71.2L73.4 72.9L71.6 74.8L70 76.7L68.4 78.8L67.1 81L68.4 83.2L70 85.3L71.6 87.2L73.4 89.1L75.2 90.8L77.3 92.4L79.4 93.9L81.6 95.2L83.8 96.4L86.2 97.4L88.6 98.3L91.1 98.9L93.6 99.5L96.2 99.8L98.7 100L101.3 100L103.8 99.8L106.4 99.5L108.9 98.9L111.4 98.3L113.8 97.4L116.2 96.4L118.4 95.2L120.6 93.9L122.7 92.4L124.8 90.8L126.6 89.1L128.4 87.2L130 85.3L131.6 83.2Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.08)"/>
    </svg>
    <div class="header-logo-text">
      <div class="header-logo-name"><span>Gaias</span>Grounds</div>
      <div class="header-logo-sub">Of the Earth · For the World</div>
    </div>
  </a>
  <a href="https://gaiasglobal.com" target="_blank" class="header-global">
    <svg width="16" height="16" viewBox="60 60 80 80" fill="none" style="opacity:0.55;flex-shrink:0;">
      <path d="M67.1 119L68.4 121.2L70 123.3L71.6 125.2L73.4 127.1L75.2 128.8L77.3 130.4L79.4 131.9L81.6 133.2L83.8 134.4L86.2 135.4L88.6 136.3L91.1 136.9L93.6 137.5L96.2 137.8L98.7 138L101.3 138L103.8 137.8L106.4 137.5L108.9 136.9L111.4 136.3L113.8 135.4L116.2 134.4L118.4 133.2L120.6 131.9L122.7 130.4L124.8 128.8L126.6 127.1L128.4 125.2L130 123.3L131.6 121.2L132.9 119L131.6 116.8L130 114.7L128.4 112.8L126.6 110.9L124.8 109.2L122.7 107.6L120.6 106.1L118.4 104.8L116.2 103.6L113.8 102.6L111.4 101.7L108.9 101.1L106.4 100.5L103.8 100.2L101.3 100L98.7 100L96.2 100.2L93.6 100.5L91.1 101.1L88.6 101.7L86.2 102.6L83.8 103.6L81.6 104.8L79.4 106.1L77.3 107.6L75.2 109.2L73.4 110.9L71.6 112.8L70 114.7L68.4 116.8Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.12)"/>
      <path d="M100 138L102.6 137.9L105.1 137.7L107.6 137.2L110.1 136.6L112.6 135.9L115 134.9L117.3 133.8L119.6 132.6L121.7 131.2L123.8 129.7L125.7 128L127.5 126.2L129.2 124.3L130.8 122.2L132.2 120.1L133.5 117.9L134.7 115.6L135.6 113.2L136.4 110.8L137.1 108.3L137.6 105.8L137.9 103.2L138 100.6L138 98.1L137.7 95.5L137.3 93L136.8 90.5L136.1 88L135.2 85.6L134.1 83.3L132.9 81L130.3 81.1L127.8 81.3L125.3 81.8L122.8 82.4L120.3 83.1L117.9 84.1L115.6 85.2L113.4 86.4L111.2 87.8L109.1 89.3L107.2 91L105.4 92.8L103.7 94.7L102.1 96.8L100.7 98.9L99.4 101.1L98.2 103.4L97.3 105.8L96.5 108.2L95.8 110.7L95.3 113.2L95 115.8L94.9 118.4L95 120.9L95.2 123.5L95.6 126L96.1 128.5L96.8 131L97.7 133.4L98.8 135.7Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.12)"/>
      <path d="M132.9 119L134.1 116.7L135.2 114.4L136.1 112L136.8 109.5L137.3 107L137.7 104.5L138 101.9L138 99.4L137.9 96.8L137.6 94.2L137.1 91.7L136.4 89.2L135.6 86.8L134.7 84.4L133.5 82.1L132.2 79.9L130.8 77.8L129.2 75.7L127.5 73.8L125.7 72L123.8 70.3L121.7 68.8L119.6 67.4L117.3 66.2L115 65.1L112.6 64.1L110.1 63.4L107.6 62.8L105.1 62.3L102.6 62.1L100 62L98.8 64.3L97.7 66.6L96.8 69L96.1 71.5L95.6 74L95.2 76.5L95 79.1L94.9 81.6L95 84.2L95.3 86.8L95.8 89.3L96.5 91.8L97.3 94.2L98.2 96.6L99.4 98.9L100.7 101.1L102.1 103.2L103.7 105.3L105.4 107.2L107.2 109L109.1 110.7L111.2 112.2L113.4 113.6L115.6 114.8L117.9 115.9L120.3 116.9L122.8 117.6L125.3 118.2L127.8 118.7L130.3 118.9Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.12)"/>
      <path d="M100 62L97.4 62.1L94.9 62.3L92.4 62.8L89.9 63.4L87.4 64.1L85 65.1L82.7 66.2L80.4 67.4L78.3 68.8L76.2 70.3L74.3 72L72.5 73.8L70.8 75.7L69.2 77.8L67.8 79.9L66.5 82.1L65.3 84.4L64.4 86.8L63.6 89.2L62.9 91.7L62.4 94.2L62.1 96.8L62 99.4L62 101.9L62.3 104.5L62.7 107L63.2 109.5L63.9 112L64.8 114.4L65.9 116.7L67.1 119L69.7 118.9L72.2 118.7L74.7 118.2L77.2 117.6L79.7 116.9L82.1 115.9L84.4 114.8L86.6 113.6L88.8 112.2L90.9 110.7L92.8 109L94.6 107.2L96.3 105.3L97.9 103.2L99.3 101.1L100.6 98.9L101.8 96.6L102.7 94.2L103.5 91.8L104.2 89.3L104.7 86.8L105 84.2L105.1 81.6L105 79.1L104.8 76.5L104.4 74L103.9 71.5L103.2 69L102.3 66.6L101.2 64.3Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.12)"/>
      <path d="M67.1 81L65.9 83.3L64.8 85.6L63.9 88L63.2 90.5L62.7 93L62.3 95.5L62 98.1L62 100.6L62.1 103.2L62.4 105.8L62.9 108.3L63.6 110.8L64.4 113.2L65.3 115.6L66.5 117.9L67.8 120.1L69.2 122.2L70.8 124.3L72.5 126.2L74.3 128L76.2 129.7L78.3 131.2L80.4 132.6L82.7 133.8L85 134.9L87.4 135.9L89.9 136.6L92.4 137.2L94.9 137.7L97.4 137.9L100 138L101.2 135.7L102.3 133.4L103.2 131L103.9 128.5L104.4 126L104.8 123.5L105 120.9L105.1 118.4L105 115.8L104.7 113.2L104.2 110.7L103.5 108.2L102.7 105.8L101.8 103.4L100.6 101.1L99.3 98.9L97.9 96.8L96.3 94.7L94.6 92.8L92.8 91L90.9 89.3L88.8 87.8L86.6 86.4L84.4 85.2L82.1 84.1L79.7 83.1L77.2 82.4L74.7 81.8L72.2 81.3L69.7 81.1Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.12)"/>
      <path d="M132.9 81L131.6 78.8L130 76.7L128.4 74.8L126.6 72.9L124.8 71.2L122.7 69.6L120.6 68.1L118.4 66.8L116.2 65.6L113.8 64.6L111.4 63.7L108.9 63.1L106.4 62.5L103.8 62.2L101.3 62L98.7 62L96.2 62.2L93.6 62.5L91.1 63.1L88.6 63.7L86.2 64.6L83.8 65.6L81.6 66.8L79.4 68.1L77.3 69.6L75.2 71.2L73.4 72.9L71.6 74.8L70 76.7L68.4 78.8L67.1 81L68.4 83.2L70 85.3L71.6 87.2L73.4 89.1L75.2 90.8L77.3 92.4L79.4 93.9L81.6 95.2L83.8 96.4L86.2 97.4L88.6 98.3L91.1 98.9L93.6 99.5L96.2 99.8L98.7 100L101.3 100L103.8 99.8L106.4 99.5L108.9 98.9L111.4 98.3L113.8 97.4L116.2 96.4L118.4 95.2L120.6 93.9L122.7 92.4L124.8 90.8L126.6 89.1L128.4 87.2L130 85.3L131.6 83.2Z" stroke="#7A4F2E" stroke-width="0.6" fill="rgba(122,79,46,0.12)"/>
    </svg>
    <div class="header-global-text">
      <span>Part of</span>
      <span>Gaias Global</span>
    </div>
  </a>
</header>

<!-- Left Panel -->
<div class="panel" id="panel">
  <button class="panel-toggle" id="panel-toggle" onclick="togglePanel()" title="Collapse list">‹</button>

  <!-- Search + Filter Bar -->
  <div class="search-bar">
    <div class="search-row">
      <input class="search-input" type="text" id="search-input" placeholder="Search cafés, roasters, farms…" oninput="handleSearch()"/>
      <div class="search-divider"></div>
      <button class="filter-btn" id="filter-btn" onclick="toggleFilters()">
        <div class="filter-btn-icon">
          <span></span><span></span><span></span>
        </div>
        Filters
      </button>
    </div>

    <!-- Dropdown Filter Bar -->
    <div class="filter-bar">

      <!-- Type -->
      <div class="filter-pill" id="pill-type">
        <button class="filter-pill-btn has-selection" id="btn-type" onclick="toggleDropdown('type')">
          Type
          <svg width="10" height="6" viewBox="0 0 10 6" fill="none">
            <path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="filter-dropdown" id="drop-type">
          <span class="filter-dropdown-title">Venue Type</span>
          <label class="filter-option checked" data-filter="type" data-value="café" onclick="toggleOption(this)">
            <div class="filter-checkbox"></div>
            <span class="filter-option-label">Café</span>
          </label>
          <label class="filter-option checked" data-filter="type" data-value="roaster" onclick="toggleOption(this)">
            <div class="filter-checkbox"></div>
            <span class="filter-option-label">Roaster</span>
          </label>
          <label class="filter-option checked" data-filter="type" data-value="farm" onclick="toggleOption(this)">
            <div class="filter-checkbox"></div>
            <span class="filter-option-label">Farm</span>
          </label>
          <div class="filter-dropdown-footer">
            <button class="filter-clear-small" onclick="clearDropdown('type')">Clear</button>
          </div>
        </div>
      </div>

      <!-- Roast -->
      <div class="filter-pill" id="pill-roast">
        <button class="filter-pill-btn has-selection" id="btn-roast" onclick="toggleDropdown('roast')">
          Roast
          <svg width="10" height="6" viewBox="0 0 10 6" fill="none">
            <path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="filter-dropdown" id="drop-roast">
          <span class="filter-dropdown-title">Roast Profile</span>
          <label class="filter-option checked" data-filter="roast" data-value="light" onclick="toggleOption(this)">
            <div class="filter-checkbox"></div>
            <span class="filter-option-label">Light</span>
          </label>
          <label class="filter-option checked" data-filter="roast" data-value="medium" onclick="toggleOption(this)">
            <div class="filter-checkbox"></div>
            <span class="filter-option-label">Medium</span>
          </label>
          <div class="filter-dropdown-footer">
            <button class="filter-clear-small" onclick="clearDropdown('roast')">Clear</button>
          </div>
        </div>
      </div>

      <!-- Country -->
      <div class="filter-pill" id="pill-country">
        <button class="filter-pill-btn has-selection" id="btn-country" onclick="toggleDropdown('country')">
          Origin
          <svg width="10" height="6" viewBox="0 0 10 6" fill="none">
            <path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="filter-dropdown" id="drop-country">
          <span class="filter-dropdown-title">Country of Origin</span>
          <div id="country-options"></div>
          <div class="filter-dropdown-footer">
            <button class="filter-clear-small" onclick="clearDropdown('country')">Clear</button>
          </div>
        </div>
      </div>

      <!-- Rosette Score -->
      <div class="filter-pill" id="pill-score">
        <button class="filter-pill-btn" id="btn-score" onclick="toggleDropdown('score')">
          Score
          <svg width="10" height="6" viewBox="0 0 10 6" fill="none">
            <path d="M1 1l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
          </svg>
        </button>
        <div class="filter-dropdown" id="drop-score">
          <span class="filter-dropdown-title">Min. Rosette Score</span>
          <div class="score-options">
            <button class="score-opt active" data-value="0" onclick="selectScore(this)">Any</button>
            <button class="score-opt" data-value="3" onclick="selectScore(this)">3+</button>
            <button class="score-opt" data-value="4" onclick="selectScore(this)">4+</button>
            <button class="score-opt" data-value="5" onclick="selectScore(this)">5+</button>
            <button class="score-opt" data-value="6" onclick="selectScore(this)">6 ✦</button>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Location List -->
  <div class="location-list" id="location-list"></div>
</div>

<!-- Detail Panel -->
<div class="detail" id="detail">
  <div class="detail-close">
    <span class="detail-close-label">Location Detail</span>
    <button class="detail-close-btn" onclick="closeDetail()">✕</button>
  </div>
  <div id="detail-content"></div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  // ── DATA ──
  const LOCATIONS = [
    {id:1,name:"Café de Flore",type:"café",city:"Paris",country:"France",lat:48.854,lng:2.333,photo:"https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?w=640&q=80",description:"An iconic Parisian café serving exquisite single-origin espresso since 1887.",specialty:"Single-Origin Espresso",roast:"Light",contact:{phone:"+33 1 45 48 55 26",email:"info@cafedeflore.fr",website:"https://cafedeflore.fr"},products:[{name:"Ethiopian Yirgacheffe",price:"€4.50",notes:"Blueberry, jasmine, citrus"},{name:"Colombian Supremo",price:"€4.00",notes:"Caramel, red apple, milk chocolate"}],score:5,principles:[1,1,1,1,1,0]},
    {id:2,name:"Blue Bottle Coffee",type:"roaster",city:"San Francisco",country:"USA",lat:37.7749,lng:-122.4194,photo:"https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=640&q=80",description:"Pioneering third-wave roaster obsessed with freshness and transparency.",specialty:"Pour Over",roast:"Light-Medium",contact:{phone:"+1 510-653-3394",email:"hello@bluebottlecoffee.com",website:"https://bluebottlecoffee.com"},products:[{name:"Hayes Valley Espresso",price:"$5.00",notes:"Dark chocolate, toasted almond"},{name:"Three Africas",price:"$4.50",notes:"Tropical fruit, berry, bright acidity"}],score:4,principles:[1,1,1,1,0,0]},
    {id:3,name:"Tim Wendelboe",type:"roaster",city:"Oslo",country:"Norway",lat:59.9139,lng:10.7522,photo:"https://images.unsplash.com/photo-1442512595331-e89e73853f31?w=640&q=80",description:"World Barista Champion turned roaster. Legendary light roasts from direct trade farms.",specialty:"Filter Coffee",roast:"Light",contact:{phone:"+47 400 04 062",email:"post@timwendelboe.no",website:"https://timwendelboe.no"},products:[{name:"Finca El Paraiso",price:"NOK 85",notes:"Peach, oolong tea, candied lemon"},{name:"Guji Natural",price:"NOK 90",notes:"Strawberry, rose, dark chocolate"}],score:6,principles:[1,1,1,1,1,1]},
    {id:4,name:"Onibus Coffee",type:"café",city:"Tokyo",country:"Japan",lat:35.6762,lng:139.6503,photo:"https://images.unsplash.com/photo-1554118811-1e0d58224f24?w=640&q=80",description:"Tokyo's beloved specialty café bridging Japanese precision with global coffee culture.",specialty:"Japanese Iced Coffee",roast:"Light-Medium",contact:{phone:"+81 3-6413-8048",email:"info@onibuscoffee.com",website:"https://onibuscoffee.com"},products:[{name:"Kenya Kiambu AA",price:"¥800",notes:"Blackcurrant, tomato, brown sugar"},{name:"Brazil Sul de Minas",price:"¥750",notes:"Walnut, dark caramel, earthy"}],score:5,principles:[1,1,1,1,1,0]},
    {id:5,name:"Granja La Esperanza",type:"farm",city:"Cali",country:"Colombia",lat:3.4516,lng:-76.532,photo:"https://images.unsplash.com/photo-1447933601403-0c6688de566e?w=640&q=80",description:"Award-winning farm producing extraordinary experimental lots in the Cauca Valley.",specialty:"Experimental Process",roast:"Light",contact:{phone:"+57 2 555 1234",email:"info@granjalaesperanza.com",website:"https://granjalaesperanza.com"},products:[{name:"Cerro Azul Geisha",price:"$28/100g",notes:"Tropical, floral, lime zest"},{name:"Las Margaritas Wush Wush",price:"$22/100g",notes:"Hibiscus, passion fruit, honey"}],score:6,principles:[1,1,1,1,1,1]},
    {id:6,name:"Intelligentsia Coffee",type:"roaster",city:"Chicago",country:"USA",lat:41.8827,lng:-87.6233,photo:"https://images.unsplash.com/photo-1509042239860-f550ce710b93?w=640&q=80",description:"Direct trade pioneers. Every cup tells the story of the farmer who grew it.",specialty:"Direct Trade",roast:"Medium",contact:{phone:"+1 312-920-9390",email:"hello@intelligentsiacoffee.com",website:"https://intelligentsiacoffee.com"},products:[{name:"Black Cat Classic Espresso",price:"$4.50",notes:"Milk chocolate, dried cherry"},{name:"House Blend",price:"$4.00",notes:"Brown sugar, orange peel, walnut"}],score:4,principles:[1,1,0,1,1,0]},
    {id:7,name:"Five Elephant",type:"roaster",city:"Berlin",country:"Germany",lat:52.52,lng:13.405,photo:"https://images.unsplash.com/photo-1453614512568-c4024d13c247?w=640&q=80",description:"Berlin's leading specialty roaster, famous for their cheesecake and exceptional filter coffee.",specialty:"Filter & Espresso",roast:"Light-Medium",contact:{phone:"+49 30 96208925",email:"hello@fiveelephant.com",website:"https://fiveelephant.com"},products:[{name:"Rwanda Gitesi",price:"€5.00",notes:"Red currant, peach, honey"},{name:"Guatemala Finca La Hermosa",price:"€4.50",notes:"Milk chocolate, plum, toffee"}],score:5,principles:[1,1,1,1,1,0]},
    {id:8,name:"Proud Mary Coffee",type:"roaster",city:"Melbourne",country:"Australia",lat:-37.8136,lng:144.9631,photo:"https://images.unsplash.com/photo-1511537190424-bbbab87ac5eb?w=640&q=80",description:"Melbourne's world-class roaster known for boundary-pushing coffees and stunning presentation.",specialty:"Specialty Espresso",roast:"Light-Medium",contact:{phone:"+61 3 9417 5930",email:"hello@proudmarycoffee.com.au",website:"https://proudmarycoffee.com.au"},products:[{name:"Hologram Blend",price:"AUD $6.00",notes:"Mandarin, stone fruit, milk chocolate"},{name:"Ethiopia Bombe Natural",price:"AUD $7.50",notes:"Strawberry jam, rose, vanilla"}],score:5,principles:[1,1,1,1,1,0]},
    {id:9,name:"Kaldi's Coffee Farm",type:"farm",city:"Kaffa",country:"Ethiopia",lat:7.3333,lng:36.5667,photo:"https://images.unsplash.com/photo-1559525839-8c4b30c18b97?w=640&q=80",description:"Named after the legendary goat herder who discovered coffee. Single estate, heirloom varieties.",specialty:"Heirloom Ethiopian",roast:"Light",contact:{phone:"+251 11 551 7700",email:"info@kaldiscoffee.et",website:"https://kaldiscoffee.et"},products:[{name:"Yirgacheffe Grade 1",price:"$18/250g",notes:"Blueberry, jasmine, dark chocolate"},{name:"Sidama Sun-Dried",price:"$16/250g",notes:"Wild berries, wine, spice"}],score:6,principles:[1,1,1,1,1,1]},
    {id:10,name:"Café El Injerto",type:"farm",city:"Huehuetenango",country:"Guatemala",lat:15.3194,lng:-91.4727,photo:"https://images.unsplash.com/photo-1464983953574-0892a716854b?w=640&q=80",description:"Multi-generational family farm producing some of the world's most coveted micro-lots.",specialty:"Micro-Lot",roast:"Light-Medium",contact:{phone:"+502 7764-1574",email:"info@elinjerto.com",website:"https://elinjerto.com"},products:[{name:"Maragogype Honey",price:"$32/100g",notes:"Papaya, brown sugar, jasmine"},{name:"Bourbon Natural",price:"$28/100g",notes:"Blackberry, dark chocolate, vanilla"}],score:6,principles:[1,1,1,1,1,1]}
  ];

  const PRINCIPLES = ['Act from Love','Live Simply','Mutual Support','Well-Being','Honest Growth','Overall Quality'];

  // ── ROSETTE SVG — each petal offset from center, rotated around its own cx/cy ──
  function rosettesvg(score, size=28) {
    const cx = size/2, cy = size/2;
    const rIn  = size * 0.12;   // inner gap from center
    const rOut = size * 0.49;   // tip of petal
    const rMid = (rIn + rOut) / 2;
    const hw   = (rOut - rIn) * 0.33; // half-width at midpoint
    const angles = [0, 60, 120, 180, 240, 300];

    function petal(deg) {
      const a = deg * Math.PI / 180;
      const p = a + Math.PI / 2;
      const f = v => v.toFixed(3);
      // 4 key points: base (inner), left, tip (outer), right
      const bx = cx + rIn  * Math.sin(a), by = cy - rIn  * Math.cos(a);
      const tx = cx + rOut * Math.sin(a), ty = cy - rOut * Math.cos(a);
      const mx = cx + rMid * Math.sin(a), my = cy - rMid * Math.cos(a);
      const lx = mx + hw * Math.sin(p),   ly = my - hw * Math.cos(p);
      const rx = mx - hw * Math.sin(p),   ry = my + hw * Math.cos(p);
      // Two quadratic curves: base→left→tip, then tip→right→base
      return `M ${f(bx)} ${f(by)} Q ${f(lx)} ${f(ly)}, ${f(tx)} ${f(ty)} Q ${f(rx)} ${f(ry)}, ${f(bx)} ${f(by)} Z`;
    }

    const petals = angles.map((a, i) => {
      const on = i < score;
      const fill   = on ? '#F0C040' : 'rgba(196,162,90,0.15)';
      const stroke = on ? '#D4A020' : 'rgba(196,162,90,0.30)';
      const sw = size < 32 ? '0.8' : '1.1';
      return `<path d="${petal(a)}" fill="${fill}" stroke="${stroke}" stroke-width="${sw}"/>`;
    }).join('');

    const dot = `<circle cx="${cx}" cy="${cy}" r="${(size*0.04).toFixed(1)}" fill="#E8B84B" stroke="#C49520" stroke-width="0.6"/>`;
    return `<svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" style="flex-shrink:0;display:block;">${petals}${dot}</svg>`;
  }

  // ── MAP ──
  const map = L.map('map',{center:[20,10],zoom:2.5,zoomControl:false,attributionControl:false});
  L.control.zoom({position:'bottomright'}).addTo(map);
  L.control.attribution({position:'bottomright',prefix:''}).addTo(map);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'© OpenStreetMap contributors',maxZoom:18}).addTo(map);

  function pinIcon(type, active=false) {
    const colors={café:'#7A4F2E',roaster:'#C4A25A',farm:'#6B7C5E'};
    const c=colors[type]||colors.café;
    const s=active?1.25:1;
    return L.divIcon({
      className:'',
      html:`<div style="width:${28*s}px;height:${28*s}px;background:${c};border:2.5px solid #F2EAD8;border-radius:50% 50% 50% 0;transform:rotate(-45deg);box-shadow:0 3px ${active?16:8}px rgba(30,18,8,${active?0.4:0.2});cursor:pointer;transition:all 0.2s;"></div>`,
      iconSize:[28*s,28*s],iconAnchor:[14*s,28*s],popupAnchor:[0,-30*s]
    });
  }

  // ── STATE ──
  let visibleLocations = [...LOCATIONS];
  let markers = {};
  let activeId = null;

  // ── DROPDOWN STATE ──
  let openDropdown = null;

  function toggleDropdown(name) {
    const drop = document.getElementById('drop-' + name);
    const btn  = document.getElementById('btn-' + name);
    if (openDropdown && openDropdown !== name) {
      document.getElementById('drop-' + openDropdown).classList.remove('open');
      document.getElementById('btn-'  + openDropdown).classList.remove('open');
    }
    const isOpen = drop.classList.toggle('open');
    btn.classList.toggle('open', isOpen);
    openDropdown = isOpen ? name : null;
  }

  // Close dropdowns when clicking outside
  document.addEventListener('click', e => {
    if (!e.target.closest('.filter-pill')) {
      document.querySelectorAll('.filter-dropdown.open').forEach(d => d.classList.remove('open'));
      document.querySelectorAll('.filter-pill-btn.open').forEach(b => b.classList.remove('open'));
      openDropdown = null;
    }
  });

  // ── FILTER LOGIC ──
  function toggleOption(el) {
    el.classList.toggle('checked');
    const filter = el.dataset.filter;
    // Update pill button style
    const anyChecked = document.querySelectorAll(`.filter-option.checked[data-filter="${filter}"]`).length > 0;
    document.getElementById('btn-' + filter).classList.toggle('has-selection', anyChecked);
    applyFilters();
  }

  function clearDropdown(filter) {
    document.querySelectorAll(`.filter-option[data-filter="${filter}"]`).forEach(o => o.classList.remove('checked'));
    document.getElementById('btn-' + filter).classList.remove('has-selection');
    applyFilters();
  }

  function selectScore(el) {
    document.querySelectorAll('.score-opt').forEach(o => o.classList.remove('active'));
    el.classList.add('active');
    const btn = document.getElementById('btn-score');
    btn.classList.toggle('has-selection', el.dataset.value !== '0');
    applyFilters();
  }

  function applyFilters() {
    const types    = [...document.querySelectorAll('.filter-option.checked[data-filter="type"]')].map(o => o.dataset.value);
    const roasts   = [...document.querySelectorAll('.filter-option.checked[data-filter="roast"]')].map(o => o.dataset.value);
    const countries= [...document.querySelectorAll('.filter-option.checked[data-filter="country"]')].map(o => o.dataset.value);
    const scoreEl  = document.querySelector('.score-opt.active');
    const minScore = scoreEl ? parseInt(scoreEl.dataset.value) : 0;

    visibleLocations = LOCATIONS.filter(l => {
      if (types.length    && !types.includes(l.type))                          return false;
      if (roasts.length   && !roasts.some(r => l.roast.toLowerCase().includes(r))) return false;
      if (countries.length && !countries.includes(l.country))                  return false;
      if (l.score < minScore)                                                   return false;
      return true;
    });
    renderList(visibleLocations);
    renderMarkers(visibleLocations);
    document.getElementById('filter-count').textContent = `${visibleLocations.length} location${visibleLocations.length !== 1 ? 's' : ''}`;
  }

  // ── COUNTRIES ──

  function buildCountryChips() {
    const countries = [...new Set(LOCATIONS.map(l=>l.country))].sort();
    const container = document.getElementById('country-options');
    countries.forEach(c => {
      const label = document.createElement('label');
      label.className = 'filter-option checked';
      label.dataset.filter = 'country';
      label.dataset.value = c;
      label.onclick = () => toggleOption(label);
      label.innerHTML = '<div class="filter-checkbox"></div><span class="filter-option-label">' + c + '</span>';
      container.appendChild(label);
    });
  }

  // ── RENDER LIST ──
  function renderList(locs) {
    const container = document.getElementById('location-list');
    container.innerHTML = '';
    if (!locs.length) {
      container.innerHTML = `<div style="text-align:center;padding:3rem 1rem;color:rgba(122,79,46,0.35);font-style:italic;font-size:0.95rem;">No locations match your filters.</div>`;
      return;
    }
    locs.forEach(loc => {
      const card = document.createElement('div');
      card.className = `location-card${loc.id===activeId?' active':''}`;
      card.dataset.id = loc.id;
      const photoCard = loc.photo ? "<div style='width:100%;height:90px;overflow:hidden;border-radius:5px;margin-bottom:0.6rem;'><img src='" + loc.photo + "' style='width:100%;height:100%;object-fit:cover;opacity:0.88;' onerror='this.parentElement.style.display=\"none\"'/></div>" : "";
      card.innerHTML = photoCard + `
        <div class="card-header">
          <span class="card-name">${loc.name}</span>
          ${rosettesvg(loc.score, 30)}
        </div>
        <div class="card-place">${loc.city}, ${loc.country}</div>
        <div class="card-footer">
          <span class="pill pill-type">${loc.type}</span>
          <span class="pill pill-roast">${loc.roast}</span>
        </div>
      `;
      card.addEventListener('click', () => selectLocation(loc.id));
      container.appendChild(card);
    });
  }

  // ── RENDER MARKERS ──
  function renderMarkers(locs) {
    Object.values(markers).forEach(m => map.removeLayer(m));
    markers = {};
    locs.forEach(loc => {
      const m = L.marker([loc.lat,loc.lng],{icon:pinIcon(loc.type,false)}).addTo(map);
      m.bindPopup(`<div class="popup-name">${loc.name}</div><div class="popup-sub">${loc.city}, ${loc.country} · ${loc.specialty}</div><button class="popup-btn" onclick="selectLocation(${loc.id})">Explore →</button>`,{closeButton:false,maxWidth:220});
      m.on('click',()=>selectLocation(loc.id));
      markers[loc.id]=m;
    });
  }

  // ── SELECT ──
  function selectLocation(id) {
    if (activeId) {
      document.querySelector(`.location-card[data-id="${activeId}"]`)?.classList.remove('active');
      const prev = LOCATIONS.find(l=>l.id===activeId);
      if (prev && markers[activeId]) markers[activeId].setIcon(pinIcon(prev.type,false));
    }
    activeId = id;
    const loc = LOCATIONS.find(l=>l.id===id);
    if (!loc) return;
    document.querySelector(`.location-card[data-id="${id}"]`)?.classList.add('active');
    document.querySelector(`.location-card[data-id="${id}"]`)?.scrollIntoView({behavior:'smooth',block:'nearest'});
    if (markers[id]) {
      markers[id].setIcon(pinIcon(loc.type,true));
      map.setView([loc.lat,loc.lng],Math.max(map.getZoom(),5),{animate:true,duration:0.5});
      markers[id].openPopup();
    }
    showDetail(loc);
  }

  function showDetail(loc) {
    const principleRows = PRINCIPLES.map((name,i)=>`
      <div class="principle-row">
        <span class="principle-label">${name}</span>
        <div class="principle-bar"><div class="principle-fill" style="width:${loc.principles[i]?'100':'0'}%"></div></div>
      </div>`).join('');

    const products = loc.products.map(p=>`
      <div class="product">
        <div class="product-top"><span class="product-name">${p.name}</span><span class="product-price">${p.price}</span></div>
        <div class="product-notes">↳ ${p.notes}</div>
      </div>`).join('');

    const detailPhotoHtml = loc.photo ? "<div style='width:100%;height:160px;overflow:hidden;border-radius:6px;margin-bottom:1.1rem;background:rgba(122,79,46,0.08);'><img src='" + loc.photo + "' style='width:100%;height:100%;object-fit:cover;opacity:0.9;' onerror='this.parentElement.style.display=\"none\"'/></div>" : "";
    document.getElementById('detail-content').innerHTML = detailPhotoHtml + `
      <div class="detail-hero">
        <div class="detail-score-row">
          ${rosettesvg(loc.score, 56)}
          <div class="detail-score-info">
            <span class="detail-score-label">Rosette Score</span>
            <span class="detail-score-value">${loc.score} / 6</span>
            <span class="detail-score-sub">Gaia Curated · Values Aligned</span>
          </div>
        </div>
        <div class="detail-name">${loc.name}</div>
        <div class="detail-place">📍 ${loc.city}, ${loc.country}</div>
        <div class="detail-tags">
          <span class="pill pill-type">${loc.type}</span>
          <span class="pill pill-roast">${loc.roast} Roast</span>
        </div>
        <div class="detail-desc">${loc.description}</div>
      </div>
      <div class="detail-section">
        <span class="detail-section-label">Principle Alignment</span>
        ${principleRows}
      </div>
      <div class="detail-section">
        <span class="detail-section-label">Signature Offerings</span>
        ${products}
      </div>
      <div class="detail-section">
        <span class="detail-section-label">Contact</span>
        <div class="contact-row"><span class="contact-key">Phone</span><span class="contact-val">${loc.contact.phone}</span></div>
        <div class="contact-row"><span class="contact-key">Email</span><span class="contact-val"><a href="mailto:${loc.contact.email}">${loc.contact.email}</a></span></div>
        <div class="contact-row"><span class="contact-key">Web</span><span class="contact-val"><a href="${loc.contact.website}" target="_blank">${loc.contact.website.replace('https://','')}</a></span></div>
      </div>
    `;
    document.getElementById('detail').classList.add('open');
  }

  function closeDetail() {
    document.getElementById('detail').classList.remove('open');
    if (activeId) {
      document.querySelector(`.location-card[data-id="${activeId}"]`)?.classList.remove('active');
      const prev = LOCATIONS.find(l=>l.id===activeId);
      if (prev && markers[activeId]) markers[activeId].setIcon(pinIcon(prev.type,false));
    }
    activeId = null;
  }

  // ── SEARCH ──
  function handleSearch() {
    const q = document.getElementById('search-input').value.toLowerCase();
    const filtered = q
      ? visibleLocations.filter(l=>l.name.toLowerCase().includes(q)||l.city.toLowerCase().includes(q)||l.country.toLowerCase().includes(q)||l.specialty.toLowerCase().includes(q))
      : visibleLocations;
    renderList(filtered);
  }

  // ── PANEL COLLAPSE ──
  function togglePanel() {
    const panel  = document.getElementById('panel');
    const toggle = document.getElementById('panel-toggle');
    const collapsed = panel.classList.toggle('collapsed');
    toggle.textContent = collapsed ? '›' : '‹';
    toggle.title = collapsed ? 'Expand list' : 'Collapse list';
  }

  // ── INIT ──
  buildCountryChips();
  renderList(LOCATIONS);
  renderMarkers(LOCATIONS);
  setTimeout(()=>document.getElementById('loading').classList.add('hidden'),1100);
</script>
</body>
</html>
